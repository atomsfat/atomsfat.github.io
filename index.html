<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>Atomsfat techblog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Tomás Salazar">


    <!-- Le styles -->
    <link href="/assets/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 20px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }

      @media (max-width: 980px) {
        /* Enable use of floated navbar text */
        .navbar-text.pull-right {
          float: none;
          padding-left: 5px;
          padding-right: 5px;
        }
      }
    </style>
    <link href="/assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="../assets/js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
    <link rel="shortcut icon" href="../assets/ico/favicon.png">
  </head>
</head>
<body>

  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span3">
        <div class="well sidebar-nav">
          <div class="pagination-centered">
            <img src="https://1.gravatar.com/avatar/f732e5a8b77f8e4ed8fadc2c71916236.jpg">
          </div>
          <h5 class="text-center"><a href="/">TECHBLOG</a></h5>
          <h5 class="text-center">by <a href="https://twitter.com/atomsfat">atomsfat</a></h5>
          <ul class="nav nav-list">
            <li class="nav-header">Articulos recientes</li>
            
              <li><a href="/2014/01/28/grails-marshalling.html">Grails JSON Marshalling bien hecho.</a></li>
            
              <li><a href="/2013/08/21/hacer-un-backup-de-mysql-a-amazon-s3.html">Hacer un backup de mysql a Amazon S3</a></li>
            
              <li><a href="/2013/08/21/subir-archivos-a-amazon-s3-con-groovy.html">Subir archivos a Amazon S3 con Groovy</a></li>
            
              <li><a href="/2008/12/26/apache-webproxy-y-tunnelling.html">Apache WebProxy, y tunnelling</a></li>
            
              <li><a href="/2008/11/11/java-decompiler.html">Java Decompiler</a></li>
            
              <li><a href="/2008/11/11/java-obfuscator.html">Java Obfuscator</a></li>
            
            <li class="nav-header">Etiquetas</li>
            
              <li><a href="/tags/java.html">Java (2)</a> </a></li>
          
              <li><a href="/tags/groovy.html">Groovy (3)</a> </a></li>
          
              <li><a href="/tags/amazon.html">Amazon (2)</a> </a></li>
          
              <li><a href="/tags/s3.html">S3 (2)</a> </a></li>
          
              <li><a href="/tags/mysql.html">MySql (1)</a> </a></li>
          
              <li><a href="/tags/grails.html">Grails (1)</a> </a></li>
          
          <li class="nav-header">Por año</li>
          
            <li><a href="/2014.html">2014 (1)</a> </a></li>
        
            <li><a href="/2013.html">2013 (2)</a> </a></li>
        
            <li><a href="/2008.html">2008 (3)</a> </a></li>
        
      </ul>
    </div><!--/.well -->
  </div><!--/span-->
  <div class="span9">
        <div class="row-fluid">
  <h2><a href="/2014/01/28/grails-marshalling.html">Grails JSON Marshalling bien hecho.</a>
  </h2><span>Jan 28, 2014</span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <h1 id="personalizar-marshaller-json-en-grails">Personalizar marshaller JSON en Grails</h1>

<p>El personalizado de marshallers esta bastante documentado:</p>

<ul>
  <li><a title="title" href="http://kylewbanks.com/blog/Customizing-JSON-Grails-Object-Marshalling">Customizing JSON Output in Grails with JSON Object Marshaller</a>.</li>
</ul>

<p>Básicamente consiste en los siguientes pasos:</p>

<ol>
  <li>Creamos un marshaller para la clase (mapa con los valores que deseamos regresar)</li>
  <li>Se registra el marshaller en el <strong>BootStrap.groovy</strong>.</li>
</ol>

<p>Definir un marshaller para una clase en el <strong>BootStrap.groovy</strong>, no se esta tan mal, pero que si necesitamos definir todo el dominio
de una aplicación.</p>

<p>Una posible solución:</p>

<p><a title="title" href="http://compiledammit.com/2012/08/16/custom-json-marshalling-in-grails-done-right/">Custom JSON Marshalling in Grails, Done “Right”</a> </p>

<p>En este blog crean los marshaller en archivos separados, luego en un mapa definen los beans, y en con la ayuda del spring inyectan y 
registran. </p>

<p>Lo cual parece demasiado. </p>

<p>Mi propuesta:</p>

<ol>
  <li>Engordar la clase de dominio para que contenga su propio marshaller.</li>
  <li>Si la clase de dominio define un marshaller, que de manera automática se registre en <strong>BootStrap.groovy</strong>.</li>
</ol>

<p>Clase gorda con marshaller:</p>

<script src="https://gist.github.com/atomsfat/8673440.js"></script>

<p>Escaneo de las clases de dominio:</p>

<script src="https://gist.github.com/atomsfat/8673594.js"></script>

<p>Conclusiones:</p>

<ul>
  <li>Creo que esta solución es correcta por que no es necesario modificar el <strong>BootStrap.groovy</strong> cada vez que necesitamos un marshaller.</li>
  <li>Si se requiere un cambio es muy fácil modificar la clase de dominio.</li>
</ul>


  </div><!--/row-->
<hr>
  <div class="row-fluid">
  <h2><a href="/2013/08/21/hacer-un-backup-de-mysql-a-amazon-s3.html">Hacer un backup de mysql a Amazon S3</a>
  </h2><span>Aug 21, 2013</span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <h4 id="hacer-un-backup-de-una-base-de-datos-a-amazon-s3">Hacer un backup de una base de datos a Amazon S3</h4>

<h4 id="lista-de-pasos">Lista de pasos:</h4>
<ol>
  <li>Realizar un dump de la base</li>
  <li>Comprimir</li>
  <li>Subir a <a title="title" href="http://0.0.0.0:4567/2013/08/21/subir-archivos-a-amazon-s3-con-groovy.html">S3</a></li>
</ol>

<h4 id="dumping-compressing">Dumping, compressing</h4>
<script src="https://gist.github.com/atomsfat/6218618.js"></script>

<h4 id="uploading">Uploading</h4>

<p>Revisa link del paso 3.</p>

<p>Agrega esta linea al script anterior</p>
<pre>
  <code>
    groovy s3_up.groovy "bucket_name" dump-$name.bz2
  </code>
</pre>

<p>P.D Revisa las rutas relativas, si lo ejecutas en un cron, el contexto(enviroment) es diferente, en este ejemplo la base de datos no pide password.</p>

  </div><!--/row-->
<hr>
  <div class="row-fluid">
  <h2><a href="/2013/08/21/subir-archivos-a-amazon-s3-con-groovy.html">Subir archivos a Amazon S3 con Groovy</a>
  </h2><span>Aug 21, 2013</span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <p>Subir archivos a amazon S3, un script basado en uno de <a title="title" href="http://blog.thomnichols.org/2009/10/upload-to-s3-with-groovy">Thom Nichols</a>  y actualizado con una version mas reciente de <a title="title" href="http://jets3t.s3.amazonaws.com/downloads.html">JetS3t library</a>.</p>

<ol>
  <li>Crear bucket en S3 https://console.aws.amazon.com/s3/</li>
  <li>Crear grupo y usuario en iam https://console.aws.amazon.com/iam/, verificar que la opcion de generar acces Key este selecionado.</li>
  <li>Remplazar accessKey y secretKey en el script.</li>
</ol>

<script src="https://gist.github.com/atomsfat/6273637.js"></script>


  </div><!--/row-->
<hr>
  <div class="row-fluid">
  <h2><a href="/2008/12/26/apache-webproxy-y-tunnelling.html">Apache WebProxy, y tunnelling</a>
  </h2><span>Dec 26, 2008</span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <p>Los adminstradores de red siempre ponen restricciones sobre la
paginas que podemos ver desde la escuela o en el trabajo,  tambien
puenden monitorear las paginas que visitamos, una solucion es montar un
servidor proxy en nuestra casa y conectarnos a el para poder navegar
libres, anonimamente y sin restriciones.</p>

<p>La idea la he sacado de este sitio.</p>

<p><a href="http://daniel.haxx.se/docs/sshproxy.html">http://daniel.haxx.se/docs/sshproxy.html</a></p>

<p>El procedimiento esta escrito para Ubuntu aunque la idea aplica para todos las distribuciones linux.</p>

<h2 id="primero-necesitaremos-instalar-apache">1. Primero necesitaremos instalar apache.</h2>

<pre>
  sudo apt-get install apache2
</pre>

<p>Para detener, iniciar, reinciar el servidor apache:</p>

<pre>
  sudo /etc/init.d/apache2 stop
  sudo /etc/init.d/apache2 start
  sudo /etc/init.d/apache2 restart
</pre>

<p>Una vez que este instalado apache ve al explorador e ingresa localhost en la barra de direcciones y da enter.
Debes de ver algo como ** It works !!! ** o una pagina que confirme que apache esta funcionando.
<img alt="" title="apache-runnig" src="/assets/img/localhost_files/apache-runnig-300x188.html" /></p>

<h2 id="instalar-el-modulo-proxy-para-apache">2. Instalar el modulo proxy para apache.</h2>

<pre>
  sudo apt-get install libapache2-mod-proxy-html
</pre>

<p>Luego hay que editar la configuracion del apache para que utilize el modulo que acabamos de instalar.</p>

<p>En mi caso voy a utilizar el puerto 8888 para proxear por lo que
tengo que decirle al apache que escuche en este puerto, y deshabilitar
las escuchas al puerto 443, por que este puerto lo voy a usar para el
ssh.</p>

<pre>
  sudo gedit /etc/apache2/ports
</pre>

<p>Y agrego listen 8888 y comento el 443, el arhivo me queda asi:</p>

<pre>
    # If you just change the port or add more ports here, you will likely also
    # have to change the VirtualHost statement in
    # /etc/apache2/sites-enabled/000-default
    # This is also true if you have upgraded from before 2.2.9-3 (i.e. from
    # Debian etch). See /usr/share/doc/apache2.2-common/NEWS.Debian.gz and
    # README.Debian.gz

    NameVirtualHost *:80
    Listen 80
    Listen 8888
    &lt;ifmodule mod_ssl.c=""&gt;
        # If you add NameVirtualHost *:443 here, you will also have to change
        # the VirtualHost statement in /etc/apache2/sites-available/default-ssl
        # to &lt;VirtualHost *:443&gt;
        # Server Name Indication for SSL named virtual hosts is currently not
        # supported by MSIE on Windows XP.
        # Listen 443
    &lt;/ifmodule&gt;

    &lt;ifmodule mod_gnutls.c=""&gt;
       #  Listen 443
    &lt;/ifmodule&gt;
</pre>

<p>luego creamos un nuevo documento vacio en la siguiete ruta con el nombre "proxy"</p>

<pre>
   /etc/apache2/sites-available
</pre>

<p>Y ponemos lo siguiente</p>

<pre>
    &lt;virtualhost *:8888&gt;
      ServerAdmin webmaster@localhost

      ProxyRequests On
      ProxyVia On

      #Add ports you want to be able to connect to through your proxy here
      AllowCONNECT 443 554
      #563 1863 10000
      #443   = SSL
      #563   = TLS
      #1863  = MSN Messenger
      #10000 = Webmin

      DocumentRoot /var/www/
      &lt;directory&gt;
              Options FollowSymLinks
              AllowOverride None

            ErrorLog /var/log/apache2/proxy-error.log
            TransferLog /var/log/apache2/proxy-transfer.log
            # Possible values include: debug, info, notice, warn, error, crit,
            # alert, emerg.
            LogLevel debug

      &lt;/directory&gt;
</pre>

<p>Con lo que le estamos creando un nuevo sitio proxy que va a forwadear
 el puerto 80, 443, 544, es importante que el virtual host *: 8888 sea
igual al puerto que esta escuchando apache.</p>

<p>Configuramos el mod_proxy en el siguiente archivo:</p>

<pre>
    sudo gedit /etc/apache2/mods-available/proxy.conf
</pre>

<p>Que queda de esta forma</p>

<pre>
&lt;ifmodule mod_proxy.c=""&gt;
        #turning ProxyRequests on and allowing proxying from all may allow
        #spammers to use your proxy to send email.

        ProxyRequests On

        &lt;Proxy *:8888&gt;
                AddDefaultCharset off
                Order deny,allow
                Deny from all

                Allow from 127.0.0.1

        # Enable/disable the handling of HTTP/1.1 "Via:" headers.
        # ("Full" adds the server version; "Block" removes all outgoing Via: headers)
        # Set to one of: Off | On | Full | Block

        ProxyVia On
&lt;/ifmodule&gt;
</pre>

<p>Con lo que configuramos que solo se pueda usar el proxy desde el localhost.
Activamos el mod_proxy con esta linea.</p>

<pre>
sudo a2enmod proxy proxy_connect proxy_html proxy_http proxy_ftp
</pre>

<p>Activamos el sitio proxy</p>

<pre>
sudo a2ensite proxy
</pre>

<p>Y reinciamos el rervidor:</p>

<pre>
 sudo /etc/init.d/apache2 restart
</pre>

<p>Ya tenemos el servidor web listo.</p>

<p>Nota: si tenemos algun problema sera necesario modificar el site, y
la configurcion, para esto es necesario deshabilitar tanto el site con
el mod_proxy.
Para deshabilitar el sitio proxy</p>

<pre>
sudo a2dissite proxy
</pre>

<p>para deshabilitar el mod_proxy:</p>

<pre>
sudo a2dismod  proxy_connect proxy_html  proxy_ftp proxy
</pre>

<p>Si se deshabilita el mod_proxy es necesario deshabilitar el  site
proxy, por que este depende del mod_proxy, y el apache no arrancarria.</p>

<p>Para averiguar si funciona puedes hacer un telnet</p>

<pre>
telnet localhost 8888
</pre>

<p>Si no responde con codigo de error es por que esta bien, si ves simbolos raros esta bien.</p>

<h2 id="instalar-ssh-server-para-que-te-puedas-conectar-desde-tu-computadora-del-trabajo-o-de-la-escuela">3. Instalar ssh server para que te puedas conectar desde tu computadora del trabajo o de la escuela.</h2>

<pre>
sudo apt-get install openssh-server
</pre>

<p>Como es un hecho que este bloqueado el puerto 22 que se utiliza por
default para el protocolo ssh se debe de configurar para que use el
puerto 443 usado generalmente para https.</p>

<p>Para hacer esto hay que modificar el siguiente archivo</p>

<pre>
sudo gedit /etc/ssh/sshd_config
</pre>

<p>Cambia esta linea</p>

<pre>
  Port 22
</pre>

<p>por</p>

<pre>
  Port 443
</pre>

<p>Ahora reinicia el servidor ssh.</p>

<pre>
sudo /etc/init.d/ssh restart
</pre>

<p>Prueba conectarte a tu maquina</p>

<pre>
ssh 'user'@localhost -p 443
</pre>

<h2 id="configurar-dns-dinamico">4. Configurar DNS dinamico</h2>

<p>Si no cuentas con ip estatica, sera necesario usar servicio como <a href="http://www.no-ip.com/">no-ip.org</a></p>

<p>Para instalarlo dirigite a la siguiente pagina no-ip.org y create una
 cuenta. Luego instala el cliente en tu maquina para que se actualize tu
 ip automaticamente.</p>

<pre>
sudo apt-get install no-ip
</pre>

<p>Sigue la instrucciones, los parametros por default esta bien.</p>

<p>Ahora comprueba si esta funcionando correctamente.</p>

<pre>
sudo noip2 -S
</pre>

<p>Si el cliente de no-ip no esta corriendo utiliza.</p>

<pre>
sudo noip2
</pre>

<h2 id="configurar-tu-maquina-local">5. Configurar tu maquina local</h2>

<p>Ahora configura la maquina desde donde te vas a conectar si utilizas linux.</p>

<pre>
 ssh -L 8888:localhost:8888 user@server.at.home -p 443
</pre>

<p>Con Windows utiliza <a href="http://www.chiark.greenend.org.uk/%7Esgtatham/putty/download.html">putty</a> o <a href="http://www.extraputty.com/">extra-putty</a>.</p>

<p>Configura putty de esta forma:</p>

<p><img alt="putty1" title="Putty 1 configuracion" src="/assets/img/post/2008-12-26-putty1.png" /></p>

<p><img alt="putty1" title="Putty 2 configuracion" src="/assets/img/post/2008-12-26-putty2.png" /></p>

<p>Necesitas configurar tu explorador para que use localhost:8080 como
proxy, para todos los protocolos , si estas utilizando windows no
recomiendo utilizar internet explorer ni chrome, utiliza firefox o
opera, por que la configuracion del proxy es mas facil.</p>

<p>Mas informacion:</p>

<p><a href="http://famvdploeg.com/blog/2008/01/setting-up-an-apache2-proxy-server/">http://famvdploeg.com/blog/2008/01/setting-up-an-apache2-proxy-server/l</a></p>

  </div><!--/row-->
<hr>
  <div class="row-fluid">
  <h2><a href="/2008/11/11/java-decompiler.html">Java Decompiler</a>
  </h2><span>Nov 11, 2008</span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <p>Un decompilador es una herramienta muy util cuando necesitas modificar una clase y no cuentas con el codigo fuente.</p>

<h6>Decompiladores que conozco:</h6>

<ul>
  <li>
    <p><a href="http://varaneckas.com/jad/" target="_blank">JAD</a></p>
  </li>
  <li>
    <p><a href="http://java.decompiler.free.fr/" target="_blank">Java Decompiler   </a></p>
  </li>
</ul>

<p>Estan esta disponible para windows, mac y linux.</p>

<p>Nota: Si no quieres que decompilen tus clases utiliza un obfuscador como ProGuard del post pasado.</p>


  </div><!--/row-->
<hr>
  <div class="row-fluid">
  <h2><a href="/2008/11/11/java-obfuscator.html">Java Obfuscator</a>
  </h2><span>Nov 11, 2008</span>
  <!-- use article.summary(250) if you have Nokogiri available to show just
       the first 250 characters -->
  <p><strong>ProGuard</strong> es para hacerle uglify al codigo Java y que sea dificil de entender cuando este se decompile.</p>

<p>Descargalo desde aqui: <a title="Proguard" href="http://proguard.sourceforge.net/" target="_blank">proguard</a></p>

<p>Para ejecutarlo utiliza:</p>

<p><strong>java -jar proguardgui.jar</strong></p>

  </div><!--/row-->
<hr>

  <p>Pagina 1 de 1</p>

  

  

  </div>
</div>

<hr>

<footer>
  <p>&copy; Tomás Salazar Leal 2014</p>
</footer>

    </div><!--/.fluid-container-->

  </body>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6535072-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</html>
